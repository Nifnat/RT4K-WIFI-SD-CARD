<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SD WIFI PRO SHIT</title>

  <!-- load CSS -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/fontawesome-all.min.css">
  <link rel="stylesheet" href="css/index.css">

  <script src="js/jquery-3.2.1.slim.min.js"></script>
  <script src="js/index.js"></script>
</head>

<body>
  <div class="container">
    <div class="tm-file-form-container mt-4">
      <form action="index.html" method="GET" class="form-inline tm-file-form">
        <div method="GET" class="text-uppercase tm-setting" onclick="javascript:window.location.href='wifi.htm'">Setting</div>
        <div class="form-group tm-file-box">
          <input type="file" id="Choose" value="Choose" class="tm-file-input form-control" name="data">
          <input id="uploadButton" type="button" value="Upload" class="form-control tm-file-submit" onclick="javascript:onClickUpload('/')">
          <input id="updateButton" type="button" value="Update List" class="form-control tm-file-submit" onclick="javascript:updateList('/')">
        </div>
      </form>
    </div>

    <div class="file-boxes progress-stripes" id="probar">
      <progress class="file-boxes" id="progressbar" value="0" max="100"></progress>
    </div>

    <div id="filelist" class="row mt-4 mb-1">
      <div class="col-xl-12">
        <div id="filelistbox" class="file-boxes">
          <!-- Directory listing will be dynamically inserted here -->
        </div> <!-- filelistbox -->
      </div>
    </div>

    <footer class="row">
      <div class="col-xl-12">
        <p class="text-center p-4">Copyright &copy; <span class="tm-current-year">2025</span> FYSETC - Design: <a href="https://www.fysetc.com/"> FYSETC </a></p>
      </div>
    </footer>
  </div> <!-- .container -->

  <script>
    let currentPath = '/';

    function fetchDirectory(path) {
      fetch(`/list?path=${encodeURIComponent(path)}`)
        .then(response => response.json())
        .then(data => {
          currentPath = path;
          const fileList = document.getElementById('filelistbox');
          fileList.innerHTML = '';
          if (path !== '/') {
            const upLink = document.createElement('a');
            upLink.href = '#';
            upLink.innerText = 'Up';
            upLink.onclick = () => fetchDirectory(path + '/../');
            fileList.appendChild(upLink);
            fileList.appendChild(document.createElement('br'));
          }
          data.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.style.display = 'flex';
            itemDiv.style.alignItems = 'center';

            const itemLink = document.createElement('a');
            itemLink.href = '#';
            itemLink.innerText = item.name;
            itemLink.style.flexGrow = 1;
            itemLink.onclick = () => {
              if (item.type === 'dir') {
                fetchDirectory(path + '/' + item.name);
              } else {
                // Handle file click (e.g., download or view file)
              }
            };

            itemDiv.appendChild(itemLink);

            if (item.type === 'dir') {
              const uploadButton = document.createElement('button');
              uploadButton.innerText = 'Upload Here';
              uploadButton.onclick = () => onClickUpload(path + '/' + item.name);
              itemDiv.appendChild(uploadButton);
            }

            fileList.appendChild(itemDiv);
          });
        });
    }

    function onClickUpload(uploadPath) {
      const fileInput = document.getElementById('Choose');
      const file = fileInput.files[0];
      if (!file) {
        alert('Please select a file to upload.');
        return;
      }

      const formData = new FormData();
      formData.append('data', file);
      formData.append('path', uploadPath);

      fetch('/upload', {
        method: 'POST',
        body: formData,
      })
        .then(response => response.text())
        .then(data => {
          alert('Upload successful!');
          fetchDirectory(currentPath);
        })
        .catch(error => {
          console.error('Error uploading file:', error);
          alert('Upload failed.');
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
      fetchDirectory('/');
    });

    /* DOM is ready */
    $(function () {
      $('.tm-current-year').text(new Date().getFullYear()); // Update year in copyright
    });
  </script>
</body>

</html>